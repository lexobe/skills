# 评估协议

本文件定义了 Critiquing Skill 的共用规则，适用于所有输出模式（文本 / JSON）。

---

## 输入定义

Judge 将收到以下字段（可能缺失；缺失时按"回退规则"处理）：

### 必需输入
*   `candidate`: 被评估的输出（单条）。
*   或 `candidates`: 被评估的输出（多条，逐条评估并排名）。

### 任务与目标
*   `task`: 任务一句话。
*   `goal`: 成功标准（可量化尽量量化）。

### 输出规范
*   `output_spec`: 交付物要求（格式/结构/长度/语言/必须包含项/禁止项）。

### 约束与风险
*   `constraints`: 必须/禁止（合规/隐私/风险/时间预算/工具限制）。

### 输入材料与事实边界（可选但强烈建议）
*   `inputs`: 用户提供的材料（文本/表格/链接摘要等）。
*   `allowed_sources`: 允许引用/依赖的来源范围（若未给出，默认"仅以 inputs 为依据"）。

### 评估维度（可选）
*   `rubric`: 自定义验收清单/评分规则（若未提供，使用 `knowledge/rubric.md` 中的默认 Rubric）。
    - 建议最小结构：dimensions（维度列表）、must_include（必须覆盖项）、scoring_overrides（权重/阈值/排序覆盖）

### 评分与排序参数（可选）
*   `scoring`:
    - `weights`: 各严重度权重（默认 Critical=3, Major=2, Minor=1）
    - `threshold`: 合格阈值（默认 12）
    - `ranking`: multi 模式排序规则（若未提供，使用默认排序算法）
    - `language`: Judge 文本字段语言（默认 zh-CN；除非 output_spec 指定）

---

## 行为约束

### 锚定（可验证性）
*   每条判断**必须**锚定到 candidate 的具体位置（优先：行号；否则：引用不超过 25 字的原文片段）。
*   **不可**做"无法回溯验证"的泛泛主张（例如"不同执行者会完全不同理解"）。
*   若只能作为风险推测，**必须**标注为 `risk` 并说明依据来自何处。

### 事实与证据标准
*   若 `inputs` 缺失：默认不得引入外部事实；所有事实性断言若不在 candidate 内自证或不在 inputs 中出现，一律标记为 `unsupported`。
*   "依据"的默认标准：
    - **有依据**: inputs 直接给出，或可在 ≤2 步可复核推导中得到（推导步骤需在锚定说明中简述）。
    - **推断**: 基于 inputs 的合理推测，但存在关键缺口（必须在 risks 或 questions 中说明缺口）。
    - **无依据**: inputs 未提供且无法在上述范围内推导；不得当作事实陈述。

### 反填充（Anti-filler）
*   信息不足就明确写"无法判断：缺少 X"，并提问。
*   **不可**为了"看起来完整"而编造证据或结论。
*   使用 N/A、空数组或明确缺失说明——不硬填充。

### Judge / Generator 边界
*   Correction Directions 只能给"**方向 + 约束 + 优先级**"，**不可**给可直接粘贴替换的完整段落/方案/代码。
*   如必须举例，仅允许 ≤ 2 句（或 ≤ 3 行）的"短片段示例"，且必须标注"示例，不是答案"。

### 语言规则
*   JSON key 固定为英文。
*   除非 `output_spec` 或 `scoring.language` 指定，否则所有文本字段使用 zh-CN。
*   不得中英混用造成歧义。

---

## 回退规则（信息不足时）

| 缺失字段 | 回退行为 |
| :--- | :--- |
| `output_spec` | 用"可执行/可验证/不编造/遵守 constraints"作为最低标准；在 questions 中指出缺失 |
| `constraints` | 只对明显高风险内容做 Level 1；其余以"自洽、对齐 goal、可验收"为主 |
| `inputs` / `allowed_sources` | 默认"不得引入外部事实"；事实性断言一律做 unsupported 标注 |
| `goal` 缺失或过于笼统 | 该维度标记为 N/A；任一 Critical 维度为 N/A 时，verdict 不能为 PASS |
| `rubric` 与 `constraints` 冲突 | 以 constraints（安全/合规/隐私）优先，其次 output_spec；在 findings 中指出冲突 |
| 同时提供 `candidate` 与 `candidates` | 以 candidates 为准；candidate 视为 candidates[0] 的别名 |

---

## 评估流程（三层分形）

### Level 1: 生存约束（先判）
*   **安全/合规**: 是否包含违法、伤害、隐私泄露、危险操作等高风险内容。
*   **可验证性/现实一致性**: 是否把不确定当确定、编造事实、虚构来源/数据/能力。
*   **奖励投机**: 是否通过绕开要求、偷换概念、回避关键项来"看似完成"。
*   若命中任一严重问题：**verdict = BLOCK**，给出最小必要解释与修正方向；无需继续评分。

### Level 2: 结构质量（对齐契约）
*   逐条对照 `output_spec` / `constraints` / `rubric`：找缺失、错配、不可验收点。
*   提取结构性风险：跨情境不鲁棒、边界条件遗漏、依赖未声明、不可执行。

### Level 3: 实例质量（就地成立）
*   在"当前输入材料与约束"下，判断候选输出是否可执行、是否自洽、是否有明显错误。
*   对"主张/结论/数据"做证据检查：标注【有依据】/【推断】/【无依据】。
